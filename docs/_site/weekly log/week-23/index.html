<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Week 23 - Semantic Segmentation - Robotics Lab URJC</title>
<meta name="description" content="Once we have established a solid base for the deep learning project we move on to other tasks. With that being said, we are going to make use of a segmentation sensor already implemented in the Carla Simulator. With this sensor we can segmentate an image like the one we showed the previous week. Starting the training process we needed to record a new dataset but with segmentated images, so we proceeded to extract a dataset similar to the one we had on the previous weeks were we will make the car run clockwise and anticlockwise in three different circuits, and then we gather more data, but this time focused on the turns, for the straight instances are much more larger and we need a balanced and rich dataset.">


  <meta name="author" content="Enrique Shinohara">
  
  <meta property="article:author" content="Enrique Shinohara">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics Lab URJC">
<meta property="og:title" content="Week 23 - Semantic Segmentation">
<meta property="og:url" content="http://localhost:4000/2022-tfm-enrique-shinohara/weekly%20log/week-23/">


  <meta property="og:description" content="Once we have established a solid base for the deep learning project we move on to other tasks. With that being said, we are going to make use of a segmentation sensor already implemented in the Carla Simulator. With this sensor we can segmentate an image like the one we showed the previous week. Starting the training process we needed to record a new dataset but with segmentated images, so we proceeded to extract a dataset similar to the one we had on the previous weeks were we will make the car run clockwise and anticlockwise in three different circuits, and then we gather more data, but this time focused on the turns, for the straight instances are much more larger and we need a balanced and rich dataset.">







  <meta property="article:published_time" content="2022-11-19T00:00:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/2022-tfm-enrique-shinohara/weekly%20log/week-23/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000/2022-tfm-enrique-shinohara/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/2022-tfm-enrique-shinohara/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics Lab URJC Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/2022-tfm-enrique-shinohara/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/2022-tfm-enrique-shinohara/"><img src="/2022-tfm-enrique-shinohara/assets/images/logo.png" alt="Robotics Lab URJC"></a>
        
        <a class="site-title" href="/2022-tfm-enrique-shinohara/">
          Robotics Lab URJC
          <span class="site-subtitle">Programming Robot Intelligence</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/2022-tfm-enrique-shinohara/year-archive/">Logbook</a>
            </li><li class="masthead__menu-item">
              <a href="/2022-tfm-enrique-shinohara/about/">About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/2022-tfm-enrique-shinohara/">
        <img src="/2022-tfm-enrique-shinohara/assets/images/Enrique-Yujiro-white2.jpg" alt="Enrique Shinohara" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/2022-tfm-enrique-shinohara/" itemprop="url">Enrique Shinohara</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Masterâ€™s thesis blog</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Madrid, Spain</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/RoboticsLabURJC/2022-tfm-enrique-shinohara" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/enrique-yujiro-shinohara-soto" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:enriqueshino@gmail.com" rel="me" class="u-email">
            <meta itemprop="email" content="enriqueshino@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Week 23 - Semantic Segmentation">
    <meta itemprop="description" content="Once we have established a solid base for the deep learning project we move on to other tasks. With that being said, we are going to make use of a segmentation sensor already implemented in the Carla Simulator. With this sensor we can segmentate an image like the one we showed the previous week. Starting the training process we needed to record a new dataset but with segmentated images, so we proceeded to extract a dataset similar to the one we had on the previous weeks were we will make the car run clockwise and anticlockwise in three different circuits, and then we gather more data, but this time focused on the turns, for the straight instances are much more larger and we need a balanced and rich dataset.">
    <meta itemprop="datePublished" content="2022-11-19T00:00:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/2022-tfm-enrique-shinohara/weekly%20log/week-23/" class="u-url" itemprop="url">Week 23 - Semantic Segmentation
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <p>Once we have established a solid base for the deep learning project we move on to other tasks. With that being said, we are going to make use of a segmentation sensor already implemented in the Carla Simulator. With this sensor we can segmentate an image like the one we showed the previous week. Starting the training process we needed to record a new dataset but with segmentated images, so we proceeded to extract a dataset similar to the one we had on the previous weeks were we will make the car run clockwise and anticlockwise in three different circuits, and then we gather more data, but this time focused on the turns, for the straight instances are much more larger and we need a balanced and rich dataset.</p>

<p>While we were recolecting data we encounter a little problem exceptionally present in the Town05.</p>

<video src="https://user-images.githubusercontent.com/47086664/203985709-39ee9693-a17d-4646-a594-c910528ab343.webm" data-canonical-src="https://user-images.githubusercontent.com/47086664/203985709-39ee9693-a17d-4646-a594-c910528ab343.webm" controls="controls" muted="muted" class="align-center" style="width:70%">
</video>

<p><br /></p>

<p>As we can see from the previous video, we can observe that there is a black flickering on the images from using a hardcoded autopilot (from Carla). The reason to highlight this last part, is that this flickering can be seen when we use a neural network, or when we overload the code with tasks that slow the segmentation process. But this doensâ€™t happens in other towns as frequently as it happens in the town05. Until we sort this problem out, we decided to change the training maps, and instead of using the towns: 02, 03 and 05, we are going to use the 02, 03 and 07, where we can also try different and more complex turns.</p>

<p>Now, to balance our dataset we do the same thing we have been doing this past weeks, in order to have a model that trains equally the left and right turns without overfitting.</p>

<figure class="align-center" style="width:70%">
  <img src="http://localhost:4000/2022-tfm-enrique-shinohara/assets/images/balanced_237.png" alt="" />
  <figcaption>Histogram of the balanced dataset from town 02, 03, 07</figcaption>
</figure>

<p>Once the data is set, we train the model, trying to check how far can we train it and if it is even worth it. From the looks of it, we can see some improvements along the 240 epochs that we make it train for.</p>

<figure class="align-center" style="width:70%">
  <img src="http://localhost:4000/2022-tfm-enrique-shinohara/assets/images/epoch_loss_town237_segmentation.png" alt="" />
  <figcaption>Epoch loss graph</figcaption>
</figure>

<p>Now, for the results we can easily see that the car has grown to be more robust, being able to keep itself in the lane in more situations given the fact that by having segmentated images, we can simplify the features learned and therefore making it more robust to different types of roads.</p>

<p>In the first video we take a look at how the car performs on a training town such as 07, where the curves are quite unique.</p>

<video src="https://user-images.githubusercontent.com/47086664/203581646-f510ed09-5024-45fe-b434-5d13aaa74daa.mp4" data-canonical-src="https://user-images.githubusercontent.com/47086664/203581646-f510ed09-5024-45fe-b434-5d13aaa74daa.mp4" controls="controls" muted="muted" class="align-center" style="width:70%">
</video>
<p><br />
The next video shows us a run on town 01, similar to the town 02 with some differences such as the presence of puddles and different lighting, where as we can see, the segmentation is pretty much the same as the default weather and lighting settings.</p>

<video src="https://user-images.githubusercontent.com/47086664/203581643-3bcd345c-b243-4d34-bfba-bf706f3652aa.mp4" data-canonical-src="https://user-images.githubusercontent.com/47086664/203581643-3bcd345c-b243-4d34-bfba-bf706f3652aa.mp4" controls="controls" muted="muted" class="align-center" style="width:70%">
</video>
<p><br /></p>

<p>In the last video, we can see more oscilation with the car, trying to maintain itself inside its lane and picking up a lot of speed. Given that the speed is something we are not focusing on right now, we try to understand why it is oscillating, and if we go back for just a moment, when we saw the histogram of the dataset we can appreciate a curious case. The left hard steering is much more represented that the right hard steering values. We could be wrong, but given that the car tendencies grow bigger when it approaches the left lane, we could assume that this could be a possible explanation. In maps like town 04, when we put the car on bigger roads like one with 4 lanes, the lines arenâ€™t too close to each other, giving a space for the car to veer to the left being able to change lanes when this is not the required behaviour.</p>

<p>To further explore into our project, we are going to try to focus on two things:</p>
<ul>
  <li>Balance better the dataset for an improved behaviour</li>
  <li>Introduce more agents other than our car. We will try to teach the car to brake when it has a car running in front of it.</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/2022-tfm-enrique-shinohara/tags/#carla" class="page__taxonomy-item p-category" rel="tag">carla</a><span class="sep">, </span>
    
      <a href="/2022-tfm-enrique-shinohara/tags/#dataset" class="page__taxonomy-item p-category" rel="tag">dataset</a><span class="sep">, </span>
    
      <a href="/2022-tfm-enrique-shinohara/tags/#pilotnet" class="page__taxonomy-item p-category" rel="tag">pilotnet</a><span class="sep">, </span>
    
      <a href="/2022-tfm-enrique-shinohara/tags/#segmentation" class="page__taxonomy-item p-category" rel="tag">segmentation</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/2022-tfm-enrique-shinohara/categories/#weekly-log" class="page__taxonomy-item p-category" rel="tag">Weekly Log</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2022-11-19T00:00:00+01:00">November 19, 2022</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Week+23+-+Semantic+Segmentation%20http%3A%2F%2Flocalhost%3A4000%2F2022-tfm-enrique-shinohara%2Fweekly%2520log%2Fweek-23%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2022-tfm-enrique-shinohara%2Fweekly%2520log%2Fweek-23%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2022-tfm-enrique-shinohara%2Fweekly%2520log%2Fweek-23%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-22/" class="pagination--pager" title="Week 22 - Subjective vision for a follow-lane task
">Previous</a>
    
    
      <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-24-25/" class="pagination--pager" title="Week 24~25 - Adding some extras
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You May Also Enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-30-33/" rel="permalink">Week 30~33 - Installing BehaviourMetrics
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">For this past few weeks I have been trying to install and configurate the BehaviourMetrics repository on my local computer. With this repository the main obj...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-28-29/" rel="permalink">Week 28~29 - From good to great: improving the basic model
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With each week, we try to expand the functionality of our model by making it more robust and efficient. And is all this the basis for all the work we have be...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-27/" rel="permalink">Week 27 - Training the Brake
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This week main dish is going to revolve around teaching the car how to correctly brake when another vehicle is in front of it. But first, we better try to so...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022-tfm-enrique-shinohara/weekly%20log/week-26/" rel="permalink">Week 26 - Braking and stopping
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The task for this week is going to revolve around trying to make the car stop when another car stops in front of it, then accelerating again when the car is ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/roboticslaburjc" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/RoboticsLabURJC" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

    
      <li><a href="/2022-tfm-enrique-shinohara/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/2022-tfm-enrique-shinohara/assets/js/main.min.js"></script>










  </body>
</html>
